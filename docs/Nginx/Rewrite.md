### Rewrite

- 地址重写：实现地址的标准化；

- 地址转发：指讲一个域名指到另一个已有站点的过程；

  区别：

  | 地址转发                                                     | 地址重写                                                   |
  | ------------------------------------------------------------ | ---------------------------------------------------------- |
  | 地址转发后，客户端地址栏的地址显示是不变的                   | 地址重新后，客户端地址栏中的地址改变为服务器选择确定的地址 |
  | 地址转发只有一次网络请求                                     | 地址重新会产生两次                                         |
  | 地址转发发生在同一站点项目内                                 | 没有限制                                                   |
  | 转发后的页面可以不用全路径名表示                             | 必须使用完整的路径名表示                                   |
  | 转发过程中，可以将客户端请求的 request 范围内属性传递给新的页面 | Not  Allow                                                 |
  | 转发的速度比地址重定向要快                                   |                                                            |

###  Rewrite 规则

- if 指令

  该指令用来支持条件判断，并根据条件判断结果选择不同的 Nginx 配置，可以在 server 、location 块中配置该指令，其语法结构为;

  ```nginx
  if (condition) {...}
  ```

  - 变量名：如果变量的值为空字符串或者以“0”开头的任意字符串，if 指令认为条件为 false，其他情况认为条件为 true；比如：

    ```nginx
    if ($slow) {...}
    ```

  - “=”  “!=” 比较变量和字符串是否相等，相等时 if 指令认为条件为 true， 反之为 false；

    ```nginx
    if ($request_method = POST) { return 405;}
    ```

    注意：字符串不需要加引号；
    
  - 使用正则表达式对变量进行匹配，变量与正则表达式之间用“~”、“~* ”、“!~”、“!~*”  连接；
  
    - “~”：表示匹配过程中对大小写敏感；
    - “~*”：表示匹配过程中对大小写不敏感；
    - “!~”：匹配失败时，if 指令认为条件为 true；反之为 false；
  
    在正则表达式中，可以使用小括号对变量值进行截取，在花括号中使用$1...$9引用截取的部分；
  
    ```NGINX
    if ($http_user_agent ~ MSIE) {
      # $http_user_agent 的值中是否含有 MISE 字符串，如果包含，为 true
    }
    
    if($http_cookie ~* "id=([^;]+)(?:;|$)") {
      # Nginx 配置，可以使用 $1 和 $2 获取截取到的值，如：
      # set $id $1; 将截取到的id 赋值给 $id 变量以备后用；
    }
    ```
  
    注意： 整个正则表达式字符串一般不需要加引号，但如果含有花括号“{”、“;”  字符时，必须要给整个正则表达式添加引号；
  
  - 判断请求文件是否存在使用 "-f" 、"!-f"
  
    - "-f" ：如果请求的文件存在，if 指令认为条件为 true，请求文件不存在返回 false； 只判断文件是否存在；
  
    - "!-f"：如果请求的文件不存在但该文件所在的目录存在，if 指令认为条件为true；如果该文件和它所在的目录都不存在，则为false，如果请求的文件存在，也为 false；判断请求的文件是否不存在；
  
      ```nginx
      if(-f $request_filename){
        # 判断请求的文件是否存在
      }
      if(!-f $request_filename){
        # 判断请求的文件是否不存在
      }
      ```
  
      
  
  